<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Dashboard de Producción</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>
  body {
    font-family: 'JetBrains Mono', monospace;
    background-color: #f4f4f4;
    margin: 0;
    padding: 20px;
  }
  h1 {
    text-align: center;
    color: #3F5259;
  }
  .kpis {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin: 20px 0;
  }
  .kpi {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }
  .charts {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin: 30px 0;
  }
  .chart-container {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  canvas {
    background: #fff;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    margin-bottom: 10px;
  }
  .btn {
    font-family: 'JetBrains Mono', monospace;
    padding: 8px 16px;
    background-color: #8fc6b2;
    color: #000;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
  }
  .btn:hover {
    background-color: #78b49b;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    background: #fff;
    border-radius: 10px;
    overflow: hidden;
    margin-top: 30px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }
  th, td {
    padding: 10px 15px;
    text-align: left;
  }
  th {
    background-color: #3F5259;
    color: white;
  }
  tr:nth-child(even) {
    background-color: #f8f8f8;
  }
</style>
</head>
<body>
  <h1>Dashboard de Producción</h1>
  <div class="kpis">
    <div class="kpi"><h2 id="kpiTotal">0</h2><p>Total Producido</p></div>
    <div class="kpi"><h2 id="kpiDesperdicio">0</h2><p>Total Desperdicio</p></div>
    <div class="kpi"><h2 id="kpiPromedio">0</h2><p>Promedio Diario</p></div>
    <div class="kpi"><h2 id="kpiTopProducto">-</h2><p>Producto Top</p></div>
  </div>

  <div class="charts">
    <div class="chart-container">
      <canvas id="chartPorProducto"></canvas>
      <button class="btn" onclick="descargarChart('chartPorProducto','produccion_por_producto')">⬇ Descargar gráfico</button>
    </div>
    <div class="chart-container">
      <canvas id="chartEvolucion"></canvas>
      <button class="btn" onclick="descargarChart('chartEvolucion','evolucion_produccion')">⬇ Descargar gráfico</button>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Fecha</th>
        <th>Producto</th>
        <th>Cantidad</th>
        <th>Desperdicio</th>
        <th>Tiempo</th>
        <th>Empleados</th>
      </tr>
    </thead>
    <tbody id="tablaProduccion"></tbody>
  </table>

<script>
  const produccion = [
    {"IDProduccion": 1, "Fecha": "2025-08-01", "Producto": "Galletas", "CantidadProducida": 1820, "Desperdicio": 96, "TiempoOperativo": "7h", "EmpleadosAsignados": [101, 102]},
    {"IDProduccion": 2, "Fecha": "2025-08-01", "Producto": "Pan", "CantidadProducida": 1660, "Desperdicio": 63, "TiempoOperativo": "5h50m", "EmpleadosAsignados": [103]},
    {"IDProduccion": 3, "Fecha": "2025-08-01", "Producto": "Tortas", "CantidadProducida": 870, "Desperdicio": 12, "TiempoOperativo": "6h30m", "EmpleadosAsignados": [104, 105]},
    {"IDProduccion": 4, "Fecha": "2025-08-01", "Producto": "Facturas", "CantidadProducida": 1886, "Desperdicio": 39, "TiempoOperativo": "5h1m", "EmpleadosAsignados": [106]},
    {"IDProduccion": 5, "Fecha": "2025-08-01", "Producto": "Bizcochuelos", "CantidadProducida": 1624, "Desperdicio": 63, "TiempoOperativo": "6h40m", "EmpleadosAsignados": [107, 108]},
    {"IDProduccion": 6, "Fecha": "2025-08-02", "Producto": "Pan", "CantidadProducida": 1740, "Desperdicio": 55, "TiempoOperativo": "6h10m", "EmpleadosAsignados": [103, 109]},
    {"IDProduccion": 7, "Fecha": "2025-08-02", "Producto": "Facturas", "CantidadProducida": 1902, "Desperdicio": 44, "TiempoOperativo": "5h20m", "EmpleadosAsignados": [110]},
    {"IDProduccion": 8, "Fecha": "2025-08-02", "Producto": "Galletas", "CantidadProducida": 1785, "Desperdicio": 81, "TiempoOperativo": "6h50m", "EmpleadosAsignados": [101, 111]},
    {"IDProduccion": 9, "Fecha": "2025-08-03", "Producto": "Tortas", "CantidadProducida": 905, "Desperdicio": 15, "TiempoOperativo": "6h45m", "EmpleadosAsignados": [104, 112]},
    {"IDProduccion": 10, "Fecha": "2025-08-03", "Producto": "Bizcochuelos", "CantidadProducida": 1580, "Desperdicio": 72, "TiempoOperativo": "7h", "EmpleadosAsignados": [107]},
    {"IDProduccion": 11, "Fecha": "2025-08-03", "Producto": "Pan", "CantidadProducida": 1712, "Desperdicio": 60, "TiempoOperativo": "5h55m", "EmpleadosAsignados": [103]},
    {"IDProduccion": 12, "Fecha": "2025-08-04", "Producto": "Facturas", "CantidadProducida": 1940, "Desperdicio": 48, "TiempoOperativo": "5h5m", "EmpleadosAsignados": [106]},
    {"IDProduccion": 13, "Fecha": "2025-08-04", "Producto": "Galletas", "CantidadProducida": 1810, "Desperdicio": 90, "TiempoOperativo": "7h10m", "EmpleadosAsignados": [101, 102]},
    {"IDProduccion": 14, "Fecha": "2025-08-04", "Producto": "Tortas", "CantidadProducida": 890, "Desperdicio": 18, "TiempoOperativo": "6h25m", "EmpleadosAsignados": [105]},
    {"IDProduccion": 15, "Fecha": "2025-08-05", "Producto": "Bizcochuelos", "CantidadProducida": 1650, "Desperdicio": 70, "TiempoOperativo": "6h50m", "EmpleadosAsignados": [108]},
    {"IDProduccion": 16, "Fecha": "2025-08-05", "Producto": "Pan", "CantidadProducida": 1680, "Desperdicio": 59, "TiempoOperativo": "5h45m", "EmpleadosAsignados": [103, 109]},
    {"IDProduccion": 17, "Fecha": "2025-08-05", "Producto": "Facturas", "CantidadProducida": 1875, "Desperdicio": 41, "TiempoOperativo": "5h15m", "EmpleadosAsignados": [110]},
    {"IDProduccion": 18, "Fecha": "2025-08-06", "Producto": "Galletas", "CantidadProducida": 1835, "Desperdicio": 94, "TiempoOperativo": "7h5m", "EmpleadosAsignados": [101, 111]},
    {"IDProduccion": 19, "Fecha": "2025-08-06", "Producto": "Pan", "CantidadProducida": 1722, "Desperdicio": 62, "TiempoOperativo": "6h", "EmpleadosAsignados": [103]},
    {"IDProduccion": 20, "Fecha": "2025-08-06", "Producto": "Tortas", "CantidadProducida": 920, "Desperdicio": 16, "TiempoOperativo": "6h40m", "EmpleadosAsignados": [104, 112]},
    {"IDProduccion": 21, "Fecha": "2025-08-07", "Producto": "Facturas", "CantidadProducida": 1915, "Desperdicio": 43, "TiempoOperativo": "5h25m", "EmpleadosAsignados": [106]},
    {"IDProduccion": 22, "Fecha": "2025-08-07", "Producto": "Bizcochuelos", "CantidadProducida": 1605, "Desperdicio": 67, "TiempoOperativo": "6h55m", "EmpleadosAsignados": [107, 108]},
    {"IDProduccion": 23, "Fecha": "2025-08-07", "Producto": "Galletas", "CantidadProducida": 1790, "Desperdicio": 88, "TiempoOperativo": "7h", "EmpleadosAsignados": [101, 102]},
    {"IDProduccion": 24, "Fecha": "2025-08-08", "Producto": "Pan", "CantidadProducida": 1695, "Desperdicio": 61, "TiempoOperativo": "5h40m", "EmpleadosAsignados": [103]},
    {"IDProduccion": 25, "Fecha": "2025-08-08", "Producto": "Tortas", "CantidadProducida": 915, "Desperdicio": 14, "TiempoOperativo": "6h20m", "EmpleadosAsignados": [104]},
    {"IDProduccion": 26, "Fecha": "2025-08-08", "Producto": "Facturas", "CantidadProducida": 1932, "Desperdicio": 46, "TiempoOperativo": "5h10m", "EmpleadosAsignados": [106]}
  ];

  const totalProducido = produccion.reduce((acc, p) => acc + p.CantidadProducida, 0);
  const totalDesperdicio = produccion.reduce((acc, p) => acc + p.Desperdicio, 0);
  const dias = [...new Set(produccion.map(p => p.Fecha))].length;
  const promedio = Math.round(totalProducido / dias);

  const porProducto = {};
  produccion.forEach(p => {
    porProducto[p.Producto] = (porProducto[p.Producto] || 0) + p.CantidadProducida;
  });
  const productoTop = Object.entries(porProducto).sort((a,b)=>b[1]-a[1])[0][0];

  document.getElementById("kpiTotal").textContent = totalProducido;
  document.getElementById("kpiDesperdicio").textContent = totalDesperdicio;
  document.getElementById("kpiPromedio").textContent = promedio;
  document.getElementById("kpiTopProducto").textContent = productoTop;

  new Chart(document.getElementById("chartPorProducto"), {
    type: "bar",
    data: {
      labels: Object.keys(porProducto),
      datasets: [{
        label: "Producción total",
        data: Object.values(porProducto),
        backgroundColor: "#8fc6b2"
      }]
    }
  });

  const porDia = {};
  produccion.forEach(p => {
    porDia[p.Fecha] = (porDia[p.Fecha] || 0) + p.CantidadProducida;
  });
  new Chart(document.getElementById("chartEvolucion"), {
    type: "line",
    data: {
      labels: Object.keys(porDia),
      datasets: [{
        label: "Producción diaria",
        data: Object.values(porDia),
        borderColor: "#3F5259",
        fill: false,
        tension: 0.2
      }]
    }
  });

  const tbody = document.getElementById("tablaProduccion");
  produccion.forEach(p => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${p.IDProduccion}</td>
      <td>${p.Fecha}</td>
      <td>${p.Producto}</td>
      <td>${p.CantidadProducida}</td>
      <td>${p.Desperdicio}</td>
      <td>${p.TiempoOperativo}</td>
      <td>${p.EmpleadosAsignados.join(", ")}</td>
    `;
    tbody.appendChild(tr);
  });

  function descargarChart(chartId, nombre) {
    const chart = document.getElementById(chartId);
    const link = document.createElement("a");
    link.href = chart.toDataURL("image/png");
    link.download = nombre + ".png";
    link.click();
  }
</script>
</body>
</html>